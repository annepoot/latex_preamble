\usepackage{amsmath}        % provides \DeclareMathOperator and such
\usepackage{mathcommand}    % allows definition of commands that are different inside and outside maths environments
\usepackage{mathtools}      % provides \smallmatrix and \DeclarePairedDelimiter commands
\usepackage{xparse}         % provides string comparison
\usepackage{unicode-math}   % modern maths formatting

% Restore the original Computer Modern calligraphic alphabet
\setmathfont{Latin Modern Math}[range=\mathcal]

%%%%%%%%%%%
% Vectors %
%%%%%%%%%%%

\newcommand*{\fmtvector}[1]{{\symbfit{#1}}}

\providecommand{\va}{\fmtvector{a}}
\providecommand{\vb}{\fmtvector{b}}
\providecommand{\vc}{\fmtvector{c}}
\providecommand{\vd}{\fmtvector{d}}
\providecommand{\ve}{\fmtvector{e}}
\providecommand{\vf}{\fmtvector{f}}
\providecommand{\vg}{\fmtvector{g}}
\providecommand{\vh}{\fmtvector{h}}
\providecommand{\vi}{\fmtvector{i}}
\providecommand{\vj}{\fmtvector{j}}
\providecommand{\vk}{\fmtvector{k}}
\providecommand{\vl}{\fmtvector{l}}
\providecommand{\vm}{\fmtvector{m}}
\providecommand{\vn}{\fmtvector{n}}
\providecommand{\vo}{\fmtvector{o}}
\providecommand{\vp}{\fmtvector{p}}
\providecommand{\vq}{\fmtvector{q}}
\providecommand{\vr}{\fmtvector{r}}
\providecommand{\vs}{\fmtvector{s}}
\providecommand{\vt}{\fmtvector{t}}
\providecommand{\vu}{\fmtvector{u}}
\providecommand{\vv}{\fmtvector{v}}
\providecommand{\vw}{\fmtvector{w}}
\providecommand{\vx}{\fmtvector{x}}
\providecommand{\vy}{\fmtvector{y}}
\providecommand{\vz}{\fmtvector{z}}

\providecommand{\valpha}{\fmtvector{\alpha}}
\providecommand{\vbeta}{\fmtvector{\beta}}
\providecommand{\vgamma}{\fmtvector{\gamma}}
\providecommand{\vdelta}{\fmtvector{\delta}}
\providecommand{\vepsilon}{\fmtvector{\epsilon}}
\providecommand{\vvarepsilon}{\fmtvector{\varepsilon}}
\providecommand{\vzeta}{\fmtvector{\zeta}}
\providecommand{\veta}{\fmtvector{\eta}}
\providecommand{\vtheta}{\fmtvector{\theta}}
\providecommand{\vvartheta}{\fmtvector{\vartheta}}
\providecommand{\viota}{\fmtvector{\iota}}
\providecommand{\vkappa}{\fmtvector{\kappa}}
\providecommand{\vlambda}{\fmtvector{\fmtvectorlambda}}
\providecommand{\vmu}{\fmtvector{\mu}}
\providecommand{\vnu}{\fmtvector{\nu}}
\providecommand{\vxi}{\fmtvector{\xi}}
\providecommand{\vpi}{\fmtvector{\pi}}
\providecommand{\vrho}{\fmtvector{\rho}}
\providecommand{\vvarrho}{\fmtvector{\varrho}}
\providecommand{\vsigma}{\fmtvector{\sigma}}
\providecommand{\vtau}{\fmtvector{\tau}}
\providecommand{\vupsilon}{\fmtvector{\upsilon}}
\providecommand{\vphi}{\fmtvector{\phi}}
\providecommand{\vvarphi}{\fmtvector{\varphi}}
\providecommand{\vchi}{\fmtvector{\chi}}
\providecommand{\vpsi}{\fmtvector{\psi}}
\providecommand{\vomega}{\fmtvector{\omega}}

\providecommand{\vnull}{\fmtvector{0}}
\providecommand{\vones}{\fmtvector{1}}

%%%%%%%%%%%%
% Matrices %
%%%%%%%%%%%%

\providecommand{\fmtmatrix}[1]{{\symbfit{#1}}}

\providecommand{\mA}{\fmtmatrix{A}}
\providecommand{\mB}{\fmtmatrix{B}}
\providecommand{\mC}{\fmtmatrix{C}}
\providecommand{\mD}{\fmtmatrix{D}}
\providecommand{\mE}{\fmtmatrix{E}}
\providecommand{\mF}{\fmtmatrix{F}}
\providecommand{\mG}{\fmtmatrix{G}}
\providecommand{\mH}{\fmtmatrix{H}}
\providecommand{\mI}{\fmtmatrix{I}}
\providecommand{\mJ}{\fmtmatrix{J}}
\providecommand{\mK}{\fmtmatrix{K}}
\providecommand{\mL}{\fmtmatrix{L}}
\providecommand{\mM}{\fmtmatrix{M}}
\providecommand{\mN}{\fmtmatrix{N}}
\providecommand{\mO}{\fmtmatrix{O}}
\providecommand{\mP}{\fmtmatrix{P}}
\providecommand{\mQ}{\fmtmatrix{Q}}
\providecommand{\mR}{\fmtmatrix{R}}
\providecommand{\mS}{\fmtmatrix{S}}
\providecommand{\mT}{\fmtmatrix{T}}
\providecommand{\mU}{\fmtmatrix{U}}
\providecommand{\mV}{\fmtmatrix{V}}
\providecommand{\mW}{\fmtmatrix{W}}
\providecommand{\mX}{\fmtmatrix{X}}
\providecommand{\mY}{\fmtmatrix{Y}}
\providecommand{\mZ}{\fmtmatrix{Z}}

\providecommand{\mGamma}{\fmtmatrix{\Gamma}}
\providecommand{\mDelta}{\fmtmatrix{\Delta}}
\providecommand{\mTheta}{\fmtmatrix{\Theta}}
\providecommand{\mLambda}{\fmtmatrix{\Lambda}}
\providecommand{\mXi}{\fmtmatrix{\Xi}}
\providecommand{\mPi}{\fmtmatrix{\Pi}}
\providecommand{\mSigma}{\fmtmatrix{\Sigma}}
\providecommand{\mUpsilon}{\fmtmatrix{\Upsilon}}
\providecommand{\mPhi}{\fmtmatrix{\Phi}}
\providecommand{\mPsi}{\fmtmatrix{\Psi}}
\providecommand{\mOmega}{\fmtmatrix{\Omega}}

\providecommand{\mnull}{\fmtmatrix{0}}

%%%%%%%%%%%%%
% Operators %
%%%%%%%%%%%%%

\newcommand*{\fmtoperator}[1]{{\mathcal{#1}}}

\providecommand{\opA}{\fmtoperator{A}}
\providecommand{\opB}{\fmtoperator{B}}
\providecommand{\opC}{\fmtoperator{C}}
\providecommand{\opD}{\fmtoperator{D}}
\providecommand{\opE}{\fmtoperator{E}}
\providecommand{\opF}{\fmtoperator{F}}
\providecommand{\opG}{\fmtoperator{G}}
\providecommand{\opH}{\fmtoperator{H}}
\providecommand{\opI}{\fmtoperator{I}}
\providecommand{\opJ}{\fmtoperator{J}}
\providecommand{\opK}{\fmtoperator{K}}
\providecommand{\opL}{\fmtoperator{L}}
\providecommand{\opM}{\fmtoperator{M}}
\providecommand{\opN}{\fmtoperator{N}}
\providecommand{\opO}{\fmtoperator{O}}
\providecommand{\opP}{\fmtoperator{P}}
\providecommand{\opQ}{\fmtoperator{Q}}
\providecommand{\opR}{\fmtoperator{R}}
\providecommand{\opS}{\fmtoperator{S}}
\providecommand{\opT}{\fmtoperator{T}}
\providecommand{\opU}{\fmtoperator{U}}
\providecommand{\opV}{\fmtoperator{V}}
\providecommand{\opW}{\fmtoperator{W}}
\providecommand{\opX}{\fmtoperator{X}}
\providecommand{\opY}{\fmtoperator{Y}}
\providecommand{\opZ}{\fmtoperator{Z}}

%%%%%%%%
% Sets %
%%%%%%%%

\providecommand{\fmtset}[1]{{\mathbb{#1}}}

\providecommand{\sA}{\fmtset{A}}
\providecommand{\sB}{\fmtset{B}}
\providecommand{\sC}{\fmtset{C}}
\providecommand{\sD}{\fmtset{D}}
\providecommand{\sE}{\fmtset{E}}
\providecommand{\sF}{\fmtset{F}}
\providecommand{\sG}{\fmtset{G}}
\providecommand{\sH}{\fmtset{H}}
\providecommand{\sI}{\fmtset{I}}
\providecommand{\sJ}{\fmtset{J}}
\providecommand{\sK}{\fmtset{K}}
\providecommand{\sL}{\fmtset{L}}
\providecommand{\sM}{\fmtset{M}}
\providecommand{\sN}{\fmtset{N}}
\providecommand{\sO}{\fmtset{O}}
\providecommand{\sP}{\fmtset{P}}
\providecommand{\sQ}{\fmtset{Q}}
\providecommand{\sR}{\fmtset{R}}
\providecommand{\sS}{\fmtset{S}}
\providecommand{\sT}{\fmtset{T}}
\providecommand{\sU}{\fmtset{U}}
\providecommand{\sV}{\fmtset{V}}
\providecommand{\sW}{\fmtset{W}}
\providecommand{\sX}{\fmtset{X}}
\providecommand{\sY}{\fmtset{Y}}
\providecommand{\sZ}{\fmtset{Z}}

% Special sets
\providecommand{\N}{\sN}   % natural numbers
\providecommand{\Z}{\sZ}   % integer numbers
\providecommand{\Q}{\sQ}   % rational numbers
\providecommand{\R}{\sR}   % real numbers
\providecommand{\C}{\sC}   % complex numbers

%%%%%%%%%%%%%%%%%%%%
% Matrix operators %
%%%%%%%%%%%%%%%%%%%%

% Superscripts and subscripts
\newcommand*{\super}[2]{{#1^{#2}}}
\newcommand*{\sub}[2]{{#1_{#2}}}

% Core matrix operators
\newcommand*{\transposesymbol}{\mathsf{T}}
\newcommand*{\hermitiansymbol}{\mathsf{H}}
\newcommand*{\adjointsymbol}{*}
\newcommand*{\inversesymbol}{-}
\newcommand*{\pseudoinversesymbol}{+}

\newcommand*{\transpose}[1]{\super{#1}{\transposesymbol}}
\newcommand*{\conjugate}[1]{{\overline{#1}}}
\newcommand*{\hermitian}[1]{\super{#1}{\hermitiansymbol}}
\newcommand*{\adjoint}[1]{\super{#1}{\adjointsymbol}}
\newcommand*{\inverse}[1]{\super{#1}{\inversesymbol 1}}
\newcommand*{\pseudoinverse}[1]{\super{#1}{\pseudoinversesymbol}}
\newcommand*{\squaredinverse}[1]{\super{#1}{\inversesymbol 2}}

% Abbreviations
\providecommand{\T}[1]{\transpose{#1}}
\providecommand{\H}[1]{\hermitian{#1}}
\providecommand{\adj}[1]{\adjoint{#1}}
\providecommand{\inv}[1]{\inverse{#1}}
\providecommand{\pinv}[1]{\pseudoinverse{#1}}
\providecommand{\sqinv}[1]{\squaredinverse{#1}}

% Combined operators
\providecommand{\Tinv}[1]{\super{#1}{\inversesymbol\transposesymbol}}
\providecommand{\adjinv}[1]{\super{#1}{\inversesymbol\adjointsymbol}}
\providecommand{\Tpinv}[1]{\super{#1}{\pseudoinversesymbol\transposesymbol}}
\providecommand{\adjpinv}[1]{\super{#1}{\pseudoinversesymbol\adjointsymbol}}
\providecommand{\invT}[1]{\Tinv}
\providecommand{\invadj}[1]{\adjinv}
\providecommand{\pinvT}[1]{\Tpseudoinv}
\providecommand{\pinvadj}[1]{\adjpseudoinv}

%%%%%%%%%%%%%%
% Delimiters %
%%%%%%%%%%%%%%
\DeclarePairedDelimiter{\parens}{\lparen}{\rparen}
\DeclarePairedDelimiter{\bracks}{\lbrack}{\rbrack}
\DeclarePairedDelimiter{\braces}{\lbrace}{\rbrace}
\DeclarePairedDelimiter{\angles}{\langle}{\rangle}
\DeclarePairedDelimiter{\singlepipes}{|}{|}
\DeclarePairedDelimiter{\doublepipes}{\|}{\|}

%%%%%%%%%%%%%%%%%%%
% Custom matrices %
%%%%%%%%%%%%%%%%%%%

\newcommand{\bmat}[1]{
\begin{bmatrix}
    #1
\end{bmatrix}
}

\newcommand{\bsmallmat}[1]{
\begin{bsmallmatrix}
    #1
\end{bsmallmatrix}
}

%%%%%%%%%%%%
% Calculus %
%%%%%%%%%%%%

% Differential operators
\newcommand*{\dif}[2][1]{\mathrm{d}\ifstrequal{#1}{1}{}{^{#1}} #2}
\newcommand*{\pdif}[2][1]{\partial\ifstrequal{#1}{1}{}{^{#1}} #2}
\newcommand*{\diff}[2][1]{\mathrm{d} #2\ifstrequal{#1}{1}{}{^{#1}}}
\newcommand*{\pdiff}[2][1]{\partial #2\ifstrequal{#1}{1}{}{^{#1}}}
\newcommand*{\laplacian}{\Delta}

\newcommand*{\dx}{\diff{x}}
\newcommand*{\dy}{\diff{y}}
\newcommand*{\dz}{\diff{z}}
\newcommand*{\dvx}{\diff{\vx}}
\newcommand*{\dvy}{\diff{\vy}}
\newcommand*{\dvz}{\diff{\vz}}

\newcommand*{\integrateover}[3][]{\ifstrempty{#1}{\int}{\int_{#1}} {#2} \, \diff{#3}}
\newcommand*{\evaluateat}[2]{\left.{#1}\right|_{#2}}

%%%%%%%%%
% Logic %
%%%%%%%%%

\newcommand*{\vardefinition}[2]{{#1}={#2}}

%%%%%%%%%%%%%%%%%
% Distributions %
%%%%%%%%%%%%%%%%%

\NewDocumentCommand{\uniform}{s o m m}{
  \IfBooleanTF{#1}{
    \IfNoValueTF{#2}{
      \mathcal{U}\parens*{#3, #4}
    }{
      \mathcal{U}\parens*{#2 | #3, #4}
    }
  }{
    \IfNoValueTF{#2}{
      \mathcal{U}\parens{#3, #4}
    }{
      \mathcal{U}\parens{#2 | #3, #4}
    }
  }
}

\NewDocumentCommand{\normal}{s o m m}{
  \IfBooleanTF{#1}{
    \IfNoValueTF{#2}{
      \mathcal{N}\parens*{#3, #4}
    }{
      \mathcal{N}\parens*{#2 | #3, #4}
    }
  }{
    \IfNoValueTF{#2}{
      \mathcal{N}\parens{#3, #4}
    }{
      \mathcal{N}\parens{#2 | #3, #4}
    }
  }
}

\NewDocumentCommand{\dirac}{s m}{
  \IfBooleanTF{#1}
    {\delta\parens*{#2}}
    {\delta\parens{#2}}
}

\NewDocumentCommand{\GP}{s m m}{
  \IfBooleanTF{#1}
    {\mathcal{GP}\parens*{#2, #3}}
    {\mathcal{GP}\parens{#2, #3}}
}

\NewDocumentCommand{\GF}{s m m}{
  \IfBooleanTF{#1}
    {\mathcal{GF}\parens*{#2, #3}}
    {\mathcal{GF}\parens{#2, #3}}
}

\DeclareMathOperator{\variance}{Var}
\DeclareMathOperator{\covariance}{Cov}

\NewDocumentCommand{\probabilityof}{s o m}{
  \IfBooleanTF{#1}
    {p\parens*{#3\IfValueT{#2}{|#2}}}
    {p\parens{#3\IfValueT{#2}{|#2}}}
}

\NewDocumentCommand{\proposalof}{s m}{
  \IfBooleanTF{#1}
    {q\parens*{#2}}
    {q\parens{#2}}
}

\NewDocumentCommand{\expectationof}{s m}{
  \IfBooleanTF{#1}
    {\mathbb{E}\bracks*{#2}}
    {\mathbb{E}\bracks{#2}}
}

\NewDocumentCommand{\varianceof}{s m}{
  \IfBooleanTF{#1}
    {\variance\parens*{#2}}
    {\variance\parens{#2}}
}

\NewDocumentCommand{\covarianceof}{s m m}{
  \IfBooleanTF{#1}
    {\covariance\parens*{#2, #3}}
    {\covariance\parens{#2, #3}}
}

\DeclareMathOperator{\wasserstein}{W}

\NewDocumentCommand{\wassersteinof}{s o m m}{
  \IfBooleanTF{#1}
    {\wasserstein_{\IfValueTF{#2}{#2}{2}}\parens*{#3, #4}}
    {\wasserstein_{\IfValueTF{#2}{#2}{2}}\parens{#3, #4}}
}

%%%%%%%%%%%%%%%%%%%%%
% General operators %
%%%%%%%%%%%%%%%%%%%%%

\DeclareMathOperator*{\diag}{diag}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\linspan}{span}
\DeclareMathOperator*{\rank}{rank}
\DeclareMathOperator*{\trace}{tr}
\DeclareMathOperator*{\range}{range}

\NewDocumentCommand{\diagof}{s m}{
  \IfBooleanTF{#1}
    {\diag\parens*{#2}}
    {\diag\parens{#2}}
}

\NewDocumentCommand{\argmaxof}{s o m}{
  \IfBooleanTF{#1}
    {\argmax\IfValueT{#2}{_{#2}}\parens*{#3}}
    {\argmax\IfValueT{#2}{_{#2}}\parens{#3}}
}

\NewDocumentCommand{\argminof}{s o m}{
  \IfBooleanTF{#1}
    {\argmin\IfValueT{#2}{_{#2}}\parens*{#3}}
    {\argmin\IfValueT{#2}{_{#2}}\parens{#3}}
}

\NewDocumentCommand{\linspanof}{s m}{
  \IfBooleanTF{#1}
    {\linspan\parens*{#2}}
    {\linspan\parens{#2}}
}

\NewDocumentCommand{\rankof}{s m}{
  \IfBooleanTF{#1}
    {\rank\parens*{#2}}
    {\rank\parens{#2}}
}

\NewDocumentCommand{\traceof}{s m}{
  \IfBooleanTF{#1}
    {\trace\parens*{#2}}
    {\trace\parens{#2}}
}

\NewDocumentCommand{\rangeof}{s m}{
  \IfBooleanTF{#1}
    {\range\parens*{#2}}
    {\range\parens{#2}}
}

\NewDocumentCommand{\norm}{s o m}{
  \IfBooleanTF{#1}
    {\doublepipes*{#3}\IfValueT{#2}{_{#2}}}
    {\doublepipes{#3}\IfValueT{#2}{_{#2}}}
}

\NewDocumentCommand{\innerproduct}{s o m m}{
  \IfBooleanTF{#1}
    {\angles*{#3, #4}\IfValueT{#2}{_{#2}}}
    {\angles{#3, #4}\IfValueT{#2}{_{#2}}}
}

\NewDocumentCommand{\collection}{s m m m}{
  \IfBooleanTF{#1}
    {\braces*{#2, #3, \dots, #4}}
    {\braces{#2, #3, \dots, #4}}
}

\newcommand*{\bigO}[1]{\mathcal{O}\parens{#1}}
