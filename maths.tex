\usepackage{amsmath}        % provides \DeclareMathOperator and such
\usepackage{amsfonts}       % provides \mathbb command
\usepackage{bm}             % provides bold symbols for both latin and greek letters
\usepackage{mathcommand}    % allows definition of commands that are different inside and outside maths environments
\usepackage{mathtools}      % provides \smallmatrix and \DeclarePairedDelimiter commands
\usepackage{xparse}         % provides string comparison

%%%%%%%%%%%
% Vectors %
%%%%%%%%%%preamble/maths.tex%

\renewcommand*{\vec}[1]{{\bm{#1}}}

\newcommand*{\va}{\vec{a}}
\newcommand*{\vb}{\vec{b}}
\newcommand*{\vc}{\vec{c}}
\newcommand*{\vd}{\vec{d}}
\newcommand*{\ve}{\vec{e}}
\newcommand*{\vf}{\vec{f}}
\newcommand*{\vg}{\vec{g}}
\newcommand*{\vh}{\vec{h}}
\newcommand*{\vi}{\vec{i}}
\newcommand*{\vj}{\vec{j}}
\newcommand*{\vk}{\vec{k}}
\newcommand*{\vl}{\vec{l}}
\newcommand*{\vm}{\vec{m}}
\newcommand*{\vn}{\vec{n}}
\newcommand*{\vo}{\vec{o}}
\newcommand*{\vp}{\vec{p}}
\newcommand*{\vq}{\vec{q}}
\newcommand*{\vr}{\vec{r}}
\newcommand*{\vs}{\vec{s}}
\newcommand*{\vt}{\vec{t}}
\newcommand*{\vu}{\vec{u}}
\newcommand*{\vv}{\vec{v}}
\newcommand*{\vw}{\vec{w}}
\newcommand*{\vx}{\vec{x}}
\newcommand*{\vy}{\vec{y}}
\newcommand*{\vz}{\vec{z}}

\newcommand*{\valpha}{\vec{\alpha}}
\newcommand*{\vbeta}{\vec{\beta}}
\newcommand*{\vgamma}{\vec{\gamma}}
\newcommand*{\vdelta}{\vec{\delta}}
\newcommand*{\vepsilon}{\vec{\epsilon}}
\newcommand*{\vvarepsilon}{\vec{\varepsilon}}
\newcommand*{\vzeta}{\vec{\zeta}}
\newcommand*{\veta}{\vec{\eta}}
\newcommand*{\vtheta}{\vec{\theta}}
\newcommand*{\vvartheta}{\vec{\vartheta}}
\newcommand*{\viota}{\vec{\iota}}
\newcommand*{\vkappa}{\vec{\kappa}}
\newcommand*{\vlambda}{\vec{\lambda}}
\newcommand*{\vmu}{\vec{\mu}}
\newcommand*{\vnu}{\vec{\nu}}
\newcommand*{\vxi}{\vec{\xi}}
\newcommand*{\vpi}{\vec{\pi}}
\newcommand*{\vrho}{\vec{\rho}}
\newcommand*{\vvarrho}{\vec{\varrho}}
\newcommand*{\vsigma}{\vec{\sigma}}
\newcommand*{\vtau}{\vec{\tau}}
\newcommand*{\vupsilon}{\vec{\upsilon}}
\newcommand*{\vphi}{\vec{\phi}}
\newcommand*{\vvarphi}{\vec{\varphi}}
\newcommand*{\vchi}{\vec{\chi}}
\newcommand*{\vpsi}{\vec{\psi}}
\newcommand*{\vomega}{\vec{\omega}}

\newcommand*{\vnull}{\vec{0}}

%%%%%%%%%%%%
% Matrices %
%%%%%%%%%%%%

\newcommand*{\mat}[1]{{\bm{#1}}}

\newcommand*{\mA}{\mat{A}}
\newcommand*{\mB}{\mat{B}}
\newcommand*{\mC}{\mat{C}}
\newcommand*{\mD}{\mat{D}}
\newcommand*{\mE}{\mat{E}}
\newcommand*{\mF}{\mat{F}}
\newcommand*{\mG}{\mat{G}}
\newcommand*{\mH}{\mat{H}}
\newcommand*{\mI}{\mat{I}}
\newcommand*{\mJ}{\mat{J}}
\newcommand*{\mK}{\mat{K}}
\newcommand*{\mL}{\mat{L}}
\newcommand*{\mM}{\mat{M}}
\newcommand*{\mN}{\mat{N}}
\newcommand*{\mO}{\mat{O}}
\newcommand*{\mP}{\mat{P}}
\newcommand*{\mQ}{\mat{Q}}
\newcommand*{\mR}{\mat{R}}
\newcommand*{\mS}{\mat{S}}
\newcommand*{\mT}{\mat{T}}
\newcommand*{\mU}{\mat{U}}
\newcommand*{\mV}{\mat{V}}
\newcommand*{\mW}{\mat{W}}
\newcommand*{\mX}{\mat{X}}
\newcommand*{\mY}{\mat{Y}}
\newcommand*{\mZ}{\mat{Z}}

\newcommand*{\mGamma}{\mat{\Gamma}}
\newcommand*{\mDelta}{\mat{\Delta}}
\newcommand*{\mTheta}{\mat{\Theta}}
\newcommand*{\mLambda}{\mat{\Lambda}}
\newcommand*{\mXi}{\mat{\Xi}}
\newcommand*{\mPi}{\mat{\Pi}}
\newcommand*{\mSigma}{\mat{\Sigma}}
\newcommand*{\mUpsilon}{\mat{\Upsilon}}
\newcommand*{\mPhi}{\mat{\Phi}}
\newcommand*{\mPsi}{\mat{\Psi}}
\newcommand*{\mOmega}{\mat{\Omega}}

\newcommand*{\mnull}{\mat{0}}

%%%%%%%%%%%%%
% Operators %
%%%%%%%%%%%%%

\newcommand*{\op}[1]{{\mathcal{#1}}}

\newcommand*{\opA}{\op{A}}
\newcommand*{\opB}{\op{B}}
\newcommand*{\opC}{\op{C}}
\newcommand*{\opD}{\op{D}}
\newcommand*{\opE}{\op{E}}
\newcommand*{\opF}{\op{F}}
\newcommand*{\opG}{\op{G}}
\newcommand*{\opH}{\op{H}}
\newcommand*{\opI}{\op{I}}
\newcommand*{\opJ}{\op{J}}
\newcommand*{\opK}{\op{K}}
\newcommand*{\opL}{\op{L}}
\newcommand*{\opM}{\op{M}}
\newcommand*{\opN}{\op{N}}
\newcommand*{\opO}{\op{O}}
\newcommand*{\opP}{\op{P}}
\newcommand*{\opQ}{\op{Q}}
\newcommand*{\opR}{\op{R}}
\newcommand*{\opS}{\op{S}}
\newcommand*{\opT}{\op{T}}
\newcommand*{\opU}{\op{U}}
\newcommand*{\opV}{\op{V}}
\newcommand*{\opW}{\op{W}}
\newcommand*{\opX}{\op{X}}
\newcommand*{\opY}{\op{Y}}
\newcommand*{\opZ}{\op{Z}}

%%%%%%%%
% Sets %
%%%%%%%%

\newcommand*{\set}[1]{{\mathbb{#1}}}

\newcommand*{\sA}{\set{A}}
\newcommand*{\sB}{\set{B}}
\newcommand*{\sC}{\set{C}}
\newcommand*{\sD}{\set{D}}
\newcommand*{\sE}{\set{E}}
\newcommand*{\sF}{\set{F}}
\newcommand*{\sG}{\set{G}}
\newcommand*{\sH}{\set{H}}
\newcommand*{\sI}{\set{I}}
\newcommand*{\sJ}{\set{J}}
\newcommand*{\sK}{\set{K}}
\newcommand*{\sL}{\set{L}}
\newcommand*{\sM}{\set{M}}
\newcommand*{\sN}{\set{N}}
\newcommand*{\sO}{\set{O}}
\newcommand*{\sP}{\set{P}}
\newcommand*{\sQ}{\set{Q}}
\newcommand*{\sR}{\set{R}}
\newcommand*{\sS}{\set{S}}
\newcommand*{\sT}{\set{T}}
\newcommand*{\sU}{\set{U}}
\newcommand*{\sV}{\set{V}}
\newcommand*{\sW}{\set{W}}
\newcommand*{\sX}{\set{X}}
\newcommand*{\sY}{\set{Y}}
\newcommand*{\sZ}{\set{Z}}

% Special sets
\newcommand*{\N}{\sN}   % natural numbers
\newcommand*{\Z}{\sZ}   % integer numbers
\newcommand*{\Q}{\sQ}   % rational numbers
\newcommand*{\R}{\sR}   % real numbers
\newcommand*{\C}{\sC}   % complex numbers

%%%%%%%%%%%%%%%%%%%%
% Matrix operators %
%%%%%%%%%%%%%%%%%%%%

% Superscripts and subscripts
\newcommand*{\super}[2]{{#1^{#2}}}
\newcommand*{\sub}[2]{{#1_{#2}}}

% Core matrix operators
\newcommand*{\transposesymbol}{\mathsf{T}}
\newcommand*{\hermitiansymbol}{\mathsf{H}}
\newcommand*{\adjointsymbol}{*}
\newcommand*{\inversesymbol}{-}
\newcommand*{\pseudoinversesymbol}{+}

\newcommand*{\transpose}[1]{\super{#1}{\transposesymbol}}
\newcommand*{\conjugate}[1]{{\overline{#1}}}
\newcommand*{\hermitian}[1]{\super{#1}{\hermitiansymbol}}
\newcommand*{\adjoint}[1]{\super{#1}{\adjointsymbol}}
\newcommand*{\inverse}[1]{\super{#1}{\inversesymbol 1}}
\newcommand*{\pseudoinverse}[1]{\super{#1}{\pseudoinversesymbol}}

% Abbreviations
\newcommand*{\T}[1]{\transpose{#1}}
\renewmathcommand{\H}[1]{\hermitian{#1}}
\newcommand*{\adj}[1]{\adjoint{#1}}
\newcommand*{\inv}[1]{\inverse{#1}}
\newcommand*{\pinv}[1]{\pseudoinverse{#1}}

% Combined operators
\newcommand*{\Tinv}[1]{\super{#1}{\inversesymbol\transposesymbol}}
\newcommand*{\adjinv}[1]{\super{#1}{\inversesymbol\adjointsymbol}}
\newcommand*{\Tpinv}[1]{\super{#1}{\pseudoinversesymbol\transposesymbol}}
\newcommand*{\adjpinv}[1]{\super{#1}{\pseudoinversesymbol\adjointsymbol}}
\newcommand*{\invT}[1]{\Tinv}
\newcommand*{\invadj}[1]{\adjinv}
\newcommand*{\pinvT}[1]{\Tpseudoinv}
\newcommand*{\pinvadj}[1]{\adjpseudoinv}

%%%%%%%%%%%%%%
% Delimiters %
%%%%%%%%%%%%%%
\DeclarePairedDelimiter{\parens}{\lparen}{\rparen}
\DeclarePairedDelimiter{\bracks}{\lbrack}{\rbrack}
\DeclarePairedDelimiter{\braces}{\lbrace}{\rbrace}
\DeclarePairedDelimiter{\angles}{\langle}{\rangle}
\DeclarePairedDelimiter{\singlepipes}{|}{|}
\DeclarePairedDelimiter{\doublepipes}{\|}{\|}

%%%%%%%%%%%%%%%%%%%
% Custom matrices %
%%%%%%%%%%%%%%%%%%%

\newcommand{\bmat}[1]{
\begin{bmatrix}
    #1
\end{bmatrix}
}

\newcommand{\bsmallmat}[1]{
\begin{bsmallmatrix}
    #1
\end{bsmallmatrix}
}

%%%%%%%%%%%%
% Calculus %
%%%%%%%%%%%%

% Differential operators
\newcommand*{\dif}[2][1]{\mathrm{d}\ifstrequal{#1}{1}{}{^{#1}} #2}
\newcommand*{\pdif}[2][1]{\partial\ifstrequal{#1}{1}{}{^{#1}} #2}
\newcommand*{\diff}[2][1]{\mathrm{d} #2\ifstrequal{#1}{1}{}{^{#1}}}
\newcommand*{\pdiff}[2][1]{\partial #2\ifstrequal{#1}{1}{}{^{#1}}}
\newcommand*{\laplacian}{\Delta}

\newcommand*{\dx}{\diff{x}}
\newcommand*{\dy}{\diff{y}}
\newcommand*{\dz}{\diff{z}}
\newcommand*{\dvx}{\diff{\vx}}
\newcommand*{\dvy}{\diff{\vy}}
\newcommand*{\dvz}{\diff{\vz}}

\newcommand*{\integrateover}[3][]{\ifstrempty{#1}{\int}{\int_{#1}} {#2} \, \diff{#3}}
\newcommand*{\evaluateat}[2]{\left.{#1}\right|_{#2}}

%%%%%%%%%
% Logic %
%%%%%%%%%

\newcommand*{\vardefinition}[2]{{#1}={#2}}

%%%%%%%%%%%%%%%%%
% Distributions %
%%%%%%%%%%%%%%%%%

\NewDocumentCommand{\uniform}{s o m m}{
  \IfBooleanTF{#1}{
    \IfNoValueTF{#2}{
      \mathcal{U}\parens*{#3, #4}
    }{
      \mathcal{U}\parens*{#2 | #3, #4}
    }
  }{
    \IfNoValueTF{#2}{
      \mathcal{U}\parens{#3, #4}
    }{
      \mathcal{U}\parens{#2 | #3, #4}
    }
  }
}

\NewDocumentCommand{\normal}{s o m m}{
  \IfBooleanTF{#1}{
    \IfNoValueTF{#2}{
      \mathcal{N}\parens*{#3, #4}
    }{
      \mathcal{N}\parens*{#2 | #3, #4}
    }
  }{
    \IfNoValueTF{#2}{
      \mathcal{N}\parens{#3, #4}
    }{
      \mathcal{N}\parens{#2 | #3, #4}
    }
  }
}

\NewDocumentCommand{\dirac}{s m}{
  \IfBooleanTF{#1}
    {\delta\parens*{#2}}
    {\delta\parens{#2}}
}

\NewDocumentCommand{\GP}{s m m}{
  \IfBooleanTF{#1}
    {\mathcal{GP}\parens*{#2, #3}}
    {\mathcal{GP}\parens{#2, #3}}
}

\NewDocumentCommand{\GF}{s m m}{
  \IfBooleanTF{#1}
    {\mathcal{GF}\parens*{#2, #3}}
    {\mathcal{GF}\parens{#2, #3}}
}

\NewDocumentCommand{\GGP}{s m m}{
  \IfBooleanTF{#1}
    {\mathcal{GGP}\parens*{#2, #3}}
    {\mathcal{GGP}\parens{#2, #3}}
}

\NewDocumentCommand{\GGF}{s m m}{
  \IfBooleanTF{#1}
    {\mathcal{GGF}\parens*{#2, #3}}
    {\mathcal{GGF}\parens{#2, #3}}
}

\DeclareMathOperator{\variance}{Var}
\DeclareMathOperator{\covariance}{Cov}

\NewDocumentCommand{\probabilityof}{s o m}{
  \IfBooleanTF{#1}
    {p\parens*{#3\IfValueT{#2}{|#2}}}
    {p\parens{#3\IfValueT{#2}{|#2}}}
}

\NewDocumentCommand{\proposalof}{s m}{
  \IfBooleanTF{#1}
    {q\parens*{#2}}
    {q\parens{#2}}
}

\NewDocumentCommand{\expectationof}{s m}{
  \IfBooleanTF{#1}
    {\mathbb{E}\bracks*{#2}}
    {\mathbb{E}\bracks{#2}}
}

\NewDocumentCommand{\varianceof}{s m}{
  \IfBooleanTF{#1}
    {\variance\parens*{#2}}
    {\variance\parens{#2}}
}

\NewDocumentCommand{\covarianceof}{s m m}{
  \IfBooleanTF{#1}
    {\covariance\parens*{#2, #3}}
    {\covariance\parens{#2, #3}}
}

%%%%%%%%%%%%%%%%%%%%%
% General operators %
%%%%%%%%%%%%%%%%%%%%%

\DeclareMathOperator*{\diag}{diag}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\linspan}{span}
\DeclareMathOperator*{\rank}{rank}
\DeclareMathOperator*{\trace}{tr}

\NewDocumentCommand{\diagof}{s m}{
  \IfBooleanTF{#1}
    {\diag\parens*{#2}}
    {\diag\parens{#2}}
}

\NewDocumentCommand{\argmaxof}{s o m}{
  \IfBooleanTF{#1}
    {\argmax\IfValueT{#2}{_{#2}}\parens*{#3}}
    {\argmax\IfValueT{#2}{_{#2}}\parens{#3}}
}

\NewDocumentCommand{\argminof}{s o m}{
  \IfBooleanTF{#1}
    {\argmin\IfValueT{#2}{_{#2}}\parens*{#3}}
    {\argmin\IfValueT{#2}{_{#2}}\parens{#3}}
}

\NewDocumentCommand{\linspanof}{s m}{
  \IfBooleanTF{#1}
    {\linspan\parens*{#2}}
    {\linspan\parens{#2}}
}

\NewDocumentCommand{\rankof}{s m}{
  \IfBooleanTF{#1}
    {\rank\parens*{#2}}
    {\rank\parens{#2}}
}

\NewDocumentCommand{\traceof}{s m}{
  \IfBooleanTF{#1}
    {\trace\parens*{#2}}
    {\trace\parens{#2}}
}

\NewDocumentCommand{\norm}{s o m}{
  \IfBooleanTF{#1}
    {\doublepipes*{#3}\IfValueT{#2}{_{#2}}}
    {\doublepipes{#3}\IfValueT{#2}{_{#2}}}
}

\NewDocumentCommand{\innerproduct}{s o m m}{
  \IfBooleanTF{#1}
    {\angles*{#3, #4}\IfValueT{#2}{_{#2}}}
    {\angles{#3, #4}\IfValueT{#2}{_{#2}}}
}

\NewDocumentCommand{\collection}{s m m m}{
  \IfBooleanTF{#1}
    {\braces*{#2, #3, \dots, #4}}
    {\braces{#2, #3, \dots, #4}}
}

\newcommand*{\bigO}[1]{\mathcal{O}\parens{#1}}